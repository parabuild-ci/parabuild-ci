<?xml version="1.0"?>
<!-- author fredt@users.sourceforge.net 2001 - 2004 -->
<!-- additional targets by unsaved@users.sourceforge.net 2004 -->

<project name="hsqldb" default="help" basedir="../">
   <!-- This loads properties in the same exact way as if you ran
        "ant -Dprop1name=val1 -Dprop2name=val2...", etc.  To use all
        defaults, you should have no 'build.properties' file.
        If you don't understand this or want to know about precedence or
        how to use an Ant properties file, look up an Ant manual or an
        Ant expert.
        If you want to know, "Can I set property 'x' in 'build.properties'",
        rephrase the question to yourself as "Can I run 'ant -Dx=...?"
        Do not address questions about property file(s) to the
        hsqldb community. -->
   <property file='build/build.properties'/>

   <property name="src" value="${basedir}/src"/>
   <property name="build.debug" value="off"/>

   <target name="init">
   </target>

   <target name='explainjars'
           description="List description of jars that you can build">
     <echo>
hsqldb.jar     : default distribution jar
hsqljdbc.jar   : JDBC client only (no direct urls of form jdbc:hsqldb:mem/file/res:*)
hsqldbmain.jar : no utility programs
hsqldbmin.jar  : no utility or server programs
hsqldbtest.jar : all including test classes
hsqldbz.jar    : min jar plus necessary util classes for Zaurus
hsqlsqltool.jar: SqlTool client only (no direct urls of form jdbc:hsqldb:mem/file/res:*)

jars built with JDK 1.2 OR 1.3 can now be used with JRE 1.1.

Run 'ant -projecthelp' to list the target names to build these items.
     </echo>
   </target>

   <target name="help" description="Top-level help message">
      <echo>
usage:
   ant -help            Display ant help screen
   ant -projecthelp     Display all invocable targets
   ant ANYTHING ELSE    Run 'ant -projecthelp' for details

   jars built with JDK 1.2 OR 1.3 can now be used with JRE 1.1

examples:
   ant jar
   ant clean
      </echo>
   </target>

   <target name="-javajsse">
      <available classname="javax.net.ssl.SSLSession" property="ant.java.hasjsse"/>
      <echo message="ant.java.hasjsse=${ant.java.hasjsse}" />
   </target>

   <target name="-javaversion4">
      <available classname="java.nio.Buffer" property="ant.java.iscjava14"/>
      <available classname="java.nio.Buffer" property="ant.java.iscjavamodern"/>
   </target>

   <target name="javaversion2" depends="-javaversion4"
           unless="ant.java.iscjava14">
      <available classname="java.util.Set" property="ant.java.iscjava12"/>
      <available classname="java.util.Set" property="ant.java.iscjavamodern"/>
   </target>

   <target name="-prepare" depends="init,javaversion2">
       <mkdir dir="classes" />
   </target>

   <target name="-preparedoc" depends="init">
       <mkdir dir="doc/src" />
   </target>

   <target name="clean" depends="clean-docwork"
           description="Delete the /classes directory created by ant tasks">
        <delete dir="classes"/>
   </target>

   <target name="cleanall" depends="clean,clean-doc"
           description="Same as clean but delete the jar files as well">
      <delete>
         <fileset dir="lib" includes="hsql*.jar"/>
      </delete>
   </target>

    <target name="codeswitcher" depends="-prepare"
            description="uses +-JDBC2 +-JDBC2 +-JAVA2">
      <javac destdir="classes">
         <src path="${src}"/>
         <include name="org/hsqldb/util/CodeSwitcher.java"/>
       </javac>
    </target>

    <target name="switchtojava1target" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/lib/java/JavaSystem.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java
                    ${src}/org/hsqldb/jdbc/jdbcStatement.java
                    ${src}/org/hsqldb/rowio/RowInputTextLog.java +JAVA1TARGET"/>
       </java>
    </target>

    <target name="switchoffjava1target" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/lib/java/JavaSystem.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java
                    ${src}/org/hsqldb/jdbc/jdbcStatement.java
                    ${src}/org/hsqldb/rowio/RowInputTextLog.java -JAVA1TARGET"/>
       </java>
    </target>

    <target name="switchtodeprecatedjdbc" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/jdbc/jdbcCallableStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java +DEPRECATEDJDBC"/>
       </java>
    </target>

    <target name="switchoffdeprecatedjdbc" depends="codeswitcher"
            description="self explanatory">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/jdbc/jdbcCallableStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java -DEPRECATEDJDBC"/>
       </java>
    </target>

    <target name="switchtojdk11" depends="codeswitcher,switchtojava1target"
            description="self explanatory" unless="ant.java.iscjavamodern">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/jdbc/jdbcStubs.java
                    ${src}/org/hsqldb/jdbc/jdbcConnection.java
                    ${src}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java
                    ${src}/org/hsqldb/jdbc/jdbcCallableStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java
                    ${src}/org/hsqldb/jdbc/jdbcStatement.java
                    ${src}/org/hsqldb/rowio/RowInputTextLog.java
                    ${src}/org/hsqldb/HsqlDateTime.java -JAVA2 -JDBC3"/>
       </java>
       <available classname="java.util.Vector" property="noswing"/>
    </target>

    <target name="switchtojdk12" depends="codeswitcher,switchoffjava1target"
            description="self explanatory" if="ant.java.iscjava12">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/jdbc/jdbcStubs.java
                    ${src}/org/hsqldb/jdbc/jdbcConnection.java
                    ${src}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java
                    ${src}/org/hsqldb/jdbc/jdbcCallableStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java
                    ${src}/org/hsqldb/jdbc/jdbcStatement.java
                    ${src}/org/hsqldb/rowio/RowInputTextLog.java
                    ${src}/org/hsqldb/HsqlDateTime.java +JAVA2 -JDBC3"/>
       </java>
    </target>

    <target name="switchtojdk14" depends="codeswitcher"
            description="self explanatory" if="ant.java.iscjava14">
      <java classname="org.hsqldb.util.CodeSwitcher" classpath= "classes" >
         <arg line="${src}/org/hsqldb/jdbc/jdbcStubs.java
                    ${src}/org/hsqldb/jdbc/jdbcConnection.java
                    ${src}/org/hsqldb/jdbc/jdbcDatabaseMetaData.java
                    ${src}/org/hsqldb/jdbc/jdbcCallableStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcPreparedStatement.java
                    ${src}/org/hsqldb/jdbc/jdbcResultSet.java
                    ${src}/org/hsqldb/jdbc/jdbcStatement.java
                    ${src}/org/hsqldb/rowio/RowInputTextLog.java
                    ${src}/org/hsqldb/HsqlDateTime.java +JAVA2 +JDBC3"/>
       </java>
    </target>

    <target name="store" depends="switchtojdk11,switchtojdk12,switchtojdk14"
            description="compiles the /store folder">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
      >
         <include name="org/hsqldb/store/**"/>
      </javac>
    </target>

    <target name="lib" depends="store"
            description="compiles the /lib folder">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
      >
         <include name="org/hsqldb/lib/**"/>
         <include name="org/hsqldb/lib/java/**"/>
      </javac>
    </target>

    <target name="classes" depends="lib,-javajsse"
            description="compiles all the classes">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
         <classpath>
            <pathelement location="lib/servlet.jar"/>
         </classpath>
         <include name="*.java"/>
         <include name="org/hsqldb/*.java"/>
         <include name="org/hsqldb/resources/*.java"/>
         <include name="org/hsqldb/rowio/*.java"/>
         <include name="org/hsqldb/scriptio/*.java"/>
         <exclude name="org/hsqldb/jmx/*.java"/>
         <exclude name="org/hsqldb/lib/*.java"/>
         <exclude name="org/hsqldb/test/*.java"/>
         <exclude name="org/hsqldb/sample/*.java"/>
         <exclude name="org/hsqldb/util/*.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSource*.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
         <exclude name="org/hsqldb/jdbc/jdbcSavepoint.java"/>
         <exclude name="org/hsqldb/HsqlSocketFactorySecure.java" unless="ant.java.hasjsse"/>
         <exclude name="org/hsqldb/NIOLockFile.java"/>
         <exclude name="org/hsqldb/NIOScaledRAFile.java"/>
      </javac>
      <copy todir="${basedir}/classes/org/hsqldb/resources">
         <fileset dir="${src}/org/hsqldb/resources" includes="*.properties"/>
      </copy>
    </target>

   <target name="classes12" depends="classes" if="ant.java.iscjavamodern"
           description="compiles 1.2 specific classes">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
         <include name="org/hsqldb/jdbc/jdbcBlob.java"/>
         <include name="org/hsqldb/jdbc/jdbcClob.java"/>
      </javac>
   </target>

   <target name="classes14" depends="classes12" if="ant.java.iscjava14"
           description="compiles 1.4 specific classes">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
      <include name="org/hsqldb/jdbc/jdbcDataSource*.java"/>
      <include name="org/hsqldb/jdbc/jdbcParameterMetaData.java"/>
      <include name="org/hsqldb/jdbc/jdbcSavepoint.java"/>
      <include name="org/hsqldb/NIOLockFile.java"/>
      <include name="org/hsqldb/NIOScaledRAFile.java"/>
      </javac>
   </target>

   <target name="-test14" if="ant.java.iscjava14"
           description="compiles 1.4-specific test classes">
      <javac srcdir="${src}"
             destdir="classes"
             debug="${build.debug}"
             optimize="${build.optimize}"
             classpath="lib/junit.jar"
       >
          <include name="org/hsqldb/test/TestJDBCSavepoints.java"/>
          <include name="org/hsqldb/test/SqlToolHarness.java"/>
          <include name="org/hsqldb/test/TestSqlTool*.java"/>
      </javac>
   </target>

    <target name="util" depends="lib"
            description="compiles the /util folder">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
      >
         <include name="org/hsqldb/util/**"/>
         <exclude name="org/hsqldb/util/*Swing.java"/>
         <exclude name="org/hsqldb/util/TableSorter.java"/>
      </javac>
      <copy todir="classes/org/hsqldb/util">
      <fileset dir="${src}/org/hsqldb/util">
         <include name="hsqldb.gif"/>
      </fileset>
    </copy>
    </target>

   <target name="swing" depends="util" unless="noswing"
           description="compiles the swing based classes in the /util folder">
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
       >
      <include name="org/hsqldb/util/*Swing.java"/>
      <include name="org/hsqldb/util/TableSorter.java"/>
      </javac>
   </target>

   <target name="test" depends="classes14"
           description="compiles the /test folder">
      <available property='_junit_available' file='lib/junit.jar' type='file'/>
      <fail unless='_junit_available'
            message="'junit.jar' must reside in the /lib directory in order to use this target"/>
      <javac srcdir="${src}"
             destdir="classes"
                 debug="${build.debug}"
                 optimize="${build.optimize}"
         >
         <classpath>
            <pathelement location="lib/junit.jar"/>
            <pathelement location="lib/dbunit.jar"/>
         </classpath>
         <include name="org/hsqldb/test/**"/>
         <exclude name="org/hsqldb/test/TestJDBCSavepoints.java"/>
         <exclude name="org/hsqldb/test/SqlToolHarness.java"/>
         <exclude name="org/hsqldb/test/SqlTool*.java"/>
      </javac>
      <antcall inheritall='true' target='-test14'/>
   </target>

    <target name="jarzaurus" depends="classes14,util"
            description="Build the hsqldbz.jar for Zaurus">
        <jar jarfile="lib/hsqldbz.jar"
             basedir="classes"
         >
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*Transfer*.*"/>
         <exclude name="org/hsqldb/util/*Swing*.*"/>
         <exclude name="org/hsqldb/util/DataAccess*.*"/>
         <exclude name="org/hsqldb/util/*Helper*.*"/>
         <exclude name="org/hsqldb/util/JDBCTypes.*"/>
         <exclude name="org/hsqldb/util/SQLStatements.*"/>
         <exclude name="org/hsqldb/util/QueryTool.*"/>
         <exclude name="org/hsqldb/util/ShutdownServer.*"/>
         <exclude name="org/hsqldb/util/CodeSwitcher.*"/>
         <exclude name="org/hsqldb/test/*.*"/>
         <exclude name="org/hsqldb/sample/*.*"/>
         <exclude name="hsqlServlet.class"/>
         <exclude name="org/hsqldb/Servlet.class"/>
         <exclude name="org/hsqldb/HsqlServerFactory.class"/>
         <exclude name="org/hsqldb/HsqlServerProperties.class"/>
         <exclude name="org/hsqldb/HsqlSocketRequestHandler.class"/>
         <exclude name="org/hsqldb/HsqlSocketRequestHandlerImpl.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSource.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSourceFactory.class"/>
         <exclude name="org/hsqldb/Server.class"/>
         <exclude name="org/hsqldb/ServerConnection.class"/>
         <exclude name="org/hsqldb/WebServer.class"/>
         <exclude name="org/hsqldb/WebServerConnection.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
       </jar>
    </target>

    <target name="jartest" depends="test,swing"
            description="Build the hsqldbtest.jar (default plus test classes)">
        <jar jarfile="lib/hsqldbtest.jar"
             basedir="classes"
         >
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/sample/*.*"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
      </jar>
    </target>

    <target name="jarmain" depends="classes14"
            description="Build the hsqldbmain.jar (no utilities) (use '-Dnoswing=true jarmain' to exclude swing classes)">
        <jar jarfile="lib/hsqldbmain.jar"
             basedir="classes"
         >
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*.*"/>
         <exclude name="org/hsqldb/test/*.*"/>
         <exclude name="org/hsqldb/sample/*.*"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
      </jar>
    </target>

    <target name="jarmin" depends="classes14"
            description="Build the hsqldbmin.jar (no servers)">
        <jar jarfile="lib/hsqldbmin.jar"
             basedir="classes"
         >
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*.*"/>
         <exclude name="org/hsqldb/test/*.*"/>
         <exclude name="org/hsqldb/sample/*.*"/>
         <exclude name="org/hsqldb/resources/*.properties"/>
         <exclude name="hsqlServlet.class"/>
         <exclude name="org/hsqldb/Servlet.class"/>
         <exclude name="org/hsqldb/HsqlSocketFactory.class"/>
         <exclude name="org/hsqldb/HsqlSocketFactorySecure.class"/>
         <exclude name="org/hsqldb/HsqlServerFactory.class"/>
         <exclude name="org/hsqldb/HsqlServerProperties.class"/>
         <exclude name="org/hsqldb/HsqlSocketRequestHandler.class"/>
         <exclude name="org/hsqldb/HsqlSocketRequestHandlerImpl.class"/>
         <exclude name="org/hsqldb/Server.class"/>
         <exclude name="org/hsqldb/ServerConnection.class"/>
         <exclude name="org/hsqldb/WebServer.class"/>
         <exclude name="org/hsqldb/WebServerConnection.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSource.class"/>
         <exclude name="org/hsqldb/jdbc/jdbcDataSourceFactory.class"/>
         <exclude name="org/hsqldb/DatabaseInformationFull.class"/>
         <exclude name="org/hsqldb/rowio/RowInputLegacy.class"/>
         <exclude name="org/hsqldb/rowio/RowOutputLegacy.class"/>
         <exclude name="org/hsqldb/DIProcedureInfo.class"/>
         <exclude name="org/hsqldb/HSQLClientConnection.class"/>
         <exclude name="org/hsqldb/HTTPClientConnection.class"/>


       </jar>
    </target>

    <target name="jar" depends="classes14,util,swing"
            description="Build the default hsqldb.jar">
        <jar jarfile="lib/hsqldb.jar"
             basedir="classes"
             compress="true"
         >
         <manifest>
             <!-- This attribute is completely ignored unless the user
                  uses the jar like "java -jar .../hsqldb.jar" -->
             <attribute name='Main-Class' value='org.hsqldb.util.SqlTool'/>
         </manifest>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*Swing.*" if="noswing"/>
         <exclude name="org/hsqldb/util/Zaurus*.*"/>
         <exclude name="org/hsqldb/test/*.class"/>
         <exclude name="org/hsqldb/sample/*.class"/>
         <exclude name="org/hsqldb/jdbcStubs.class"/>
         <exclude name="org/hsqldb/jdbc/Array.class"/>
         <exclude name="org/hsqldb/jdbc/Blob.class"/>
         <exclude name="org/hsqldb/jdbc/Clob.class"/>
         <exclude name="org/hsqldb/jdbc/Ref.class"/>
         <exclude name="org/hsqldb/jdbc/Map.class"/>
      </jar>
    </target>

<!-- classes referenced by the org.hsqldb.jdbc package classes -->
<!-- or the org.hsqldb.jdbcDriver class are included here with some -->
<!-- ommissions where the calling methods are not actually used -->
    <target name="jarclient" depends="classes14"
            description="Build the hsqljdbc.jar">
        <jar jarfile="lib/hsqljdbc.jar">
            <!-- including 'org/hsqldb/jdbc*' just to be safe -->
            <fileset dir='classes'
                includes='org/hsqldb/jdbc/jdbc*,
                          org/hsqldb/jdbcDriver*,
                          org/hsqldb/rowio/RowOutputBase*,
                          org/hsqldb/rowio/RowInputBase*,
                          org/hsqldb/rowio/RowOutputBinary*,
                          org/hsqldb/rowio/RowInputBinary*,
                          org/hsqldb/rowio/RowOutputInterface*,
                          org/hsqldb/rowio/RowInputInterface*,
                          org/hsqldb/lib/InOutUtil*,
                          org/hsqldb/lib/AsciiStringInputStream*,
                          org/hsqldb/lib/StringInputStream*,
                          org/hsqldb/lib/IntValueHashMap*,
                          org/hsqldb/lib/ArrayUtil*,
                          org/hsqldb/lib/StringConverter*,
                          org/hsqldb/lib/Iterator*,
                          org/hsqldb/lib/HsqlThreadFactory*,
                          org/hsqldb/lib/ThreadFactory*,
                          org/hsqldb/lib/HsqlHeap*,
                          org/hsqldb/lib/HsqlArray*,
                          org/hsqldb/lib/ObjectComparator*,
                          org/hsqldb/lib/IntKeyHashMap*,
                          org/hsqldb/lib/Collection*,
                          org/hsqldb/lib/Set*,
                          org/hsqldb/lib/Hash*,
                          org/hsqldb/lib/HsqlTimer*,
                          org/hsqldb/lib/HsqlByte*,
                          org/hsqldb/store/ValuePool*,
                          org/hsqldb/store/HashIndex*,
                          org/hsqldb/store/BaseHashMap*,
                          org/hsqldb/Binary.*,
                          org/hsqldb/Column*,
                          org/hsqldb/DatabaseManager*,
                          org/hsqldb/HSQLClient*,
                          org/hsqldb/HsqlProperties*,
                          org/hsqldb/HsqlException*,
                          org/hsqldb/HsqlSocketFactory*,
                          org/hsqldb/HTTPClientConnection*,
                          org/hsqldb/HsqlDateTime*,
                          org/hsqldb/JavaObject.*,
                          org/hsqldb/Record*,
                          org/hsqldb/Result.*,
                          org/hsqldb/Result$*,
                          org/hsqldb/Row*,
                          org/hsqldb/SessionInterface*,
                          org/hsqldb/Trace*
                          '/>
        </jar>
    </target>
    <target name="jarsqltool" depends="classes14"
            description="Build the hsqlsqltool.jar">
        <jar jarfile="lib/hsqlsqltool.jar">
            <manifest>
                <attribute name='Main-Class' value='org.hsqldb.util.SqlTool'/>
            </manifest>
            <!-- including 'org/hsqldb/jdbc*' just to be safe -->
            <fileset dir='classes'
                includes='org/hsqldb/jdbc/jdbc*,
                          org/hsqldb/jdbcDriver*,
                          org/hsqldb/rowio/RowOutputBase*,
                          org/hsqldb/rowio/RowInputBase*,
                          org/hsqldb/rowio/RowOutputBinary*,
                          org/hsqldb/rowio/RowInputBinary*,
                          org/hsqldb/rowio/RowOutputInterface*,
                          org/hsqldb/rowio/RowInputInterface*,
                          org/hsqldb/lib/InOutUtil*,
                          org/hsqldb/lib/AsciiStringInputStream*,
                          org/hsqldb/lib/StringInputStream*,
                          org/hsqldb/lib/IntValueHashMap*,
                          org/hsqldb/lib/ArrayUtil*,
                          org/hsqldb/lib/StringConverter*,
                          org/hsqldb/lib/Iterator*,
                          org/hsqldb/lib/HsqlThreadFactory*,
                          org/hsqldb/lib/ThreadFactory*,
                          org/hsqldb/lib/HsqlHeap*,
                          org/hsqldb/lib/HsqlArray*,
                          org/hsqldb/lib/ObjectComparator*,
                          org/hsqldb/lib/IntKeyHashMap*,
                          org/hsqldb/lib/Collection*,
                          org/hsqldb/lib/Set*,
                          org/hsqldb/lib/Hash*,
                          org/hsqldb/lib/HsqlTimer*,
                          org/hsqldb/lib/HsqlByte*,
                          org/hsqldb/store/ValuePool*,
                          org/hsqldb/store/HashIndex*,
                          org/hsqldb/store/BaseHashMap*,
                          org/hsqldb/Binary.*,
                          org/hsqldb/Column*,
                          org/hsqldb/DatabaseManager*,
                          org/hsqldb/HSQLClient*,
                          org/hsqldb/HsqlProperties*,
                          org/hsqldb/HsqlException*,
                          org/hsqldb/HsqlSocketFactory*,
                          org/hsqldb/HTTPClientConnection*,
                          org/hsqldb/HsqlDateTime*,
                          org/hsqldb/JavaObject.*,
                          org/hsqldb/Record*,
                          org/hsqldb/Result.*,
                          org/hsqldb/Result$*,
                          org/hsqldb/Row*,
                          org/hsqldb/SessionInterface*,
                          org/hsqldb/Trace*
                          org/hsqldb/Types*
                          org/hsqldb/util/SqlTool*
                          org/hsqldb/util/SqlFile*
                          '/>
        </jar>
    </target>

    <target name="jarutil" depends="util,swing"
            description="Build the utility hsqldbutil.jar">
        <jar jarfile="lib/hsqldbutil.jar"
             basedir="classes"
             compress="true"
         >
         <manifest>
             <!-- This attribute is completely ignored unless the user
                  uses the jar like "java -jar .../hsqldb.jar" -->
             <attribute name='Main-Class' value='org.hsqldb.util.DatabaseManager'/>
         </manifest>
         <include name="org/hsqldb/util/*.class"/>
         <include name="org/hsqldb/lib/java/*.class"/>
         <exclude name="org/hsqldb/util/Files.class"/>
         <exclude name="org/hsqldb/util/ShutdownServer.class"/>
         <exclude name="org/hsqldb/jmx/**"/>
         <exclude name="org/hsqldb/util/*Swing.*" if="noswing"/>
         <exclude name="org/hsqldb/util/Zaurus*.*"/>
         <exclude name="org/hsqldb/test/*.class"/>
         <exclude name="org/hsqldb/sample/*.class"/>
         <exclude name="org/hsqldb/jdbc/*.class"/>
         <exclude name="org/hsqldb/rowio/*.class"/>
         <exclude name="org/hsqldb/scriptio/*.class"/>
         <exclude name="org/hsqldb/*.class"/>
      </jar>
    </target>

    <target name="javadoc" depends="-preparedoc"
            description="Create javadoc for the distribution package">
      <javadoc
                   sourcefiles="${src}/org/hsqldb/jdbcDriver.java,
                        ${src}/org/hsqldb/Trigger.java,
		   				${src}/org/hsqldb/Server.java,
		   				${src}/org/hsqldb/WebServer.java,
		   				${src}/org/hsqldb/jdbc/*.java,
		   				${src}/org/hsqldb/sample/TriggerSample.java,
		   				${src}/org/hsqldb/util/SqlTool.java"
           destdir="${basedir}/doc/src"
           classpath="${basedir}/lib/servlet.jar;${basedir}/lib/junit.jar"
           author="true"
           version="false"
           use="true"
           public="true"
           stylesheetfile="${basedir}/doc/src/hsqldbstylesheet.css"
           windowtitle="HSQLDB 1.7.2 API"
           doctitle="HSQLDB 1.7.2"
           bottom="&lt;i&gt;Copyright &#169; 2001 - 2004 HSQL Development Group. All Rights Reserved.&lt;/i&gt;">

     </javadoc>
   </target>

    <target name="javadocdev" depends="-preparedoc"
            description="Create javadoc for developers">
      <javadoc packagenames="org.hsqldb.*,org.hsqldb.jdbc.*,org.hsqldb.lib.*,org.hsqldb.util.*"
           sourcepath="${src}"
           destdir="${basedir}/doc/src"
           classpath="${basedir}/lib/servlet.jar;${basedir}/lib/junit.jar"
           author="true"
           version="false"
           use="true"
           public="true"
           stylesheetfile="${basedir}/doc/src/hsqldbstylesheet.css"
           windowtitle="HSQLDB 1.7.2 API"
           doctitle="HSQLDB 1.7.2"
           bottom="&lt;i&gt;Copyright &#169; 2001 - 2004 HSQL Development Group. All Rights Reserved.&lt;/i&gt;">
     </javadoc>
   </target>

   <!-- ******************************************************************* -->
   <!--  From here down to the matching ******* line, DocBook-related stuff -->

    <!-- Only do vigilant runtime checking for props for externally
         executable targets.  Requirements for internals are just noted -->

    <property name='fop-loglevel' value='error'/>
    <property name='style.html' value='${docbook.xsl.home}/html/docbook.xsl'/>
    <property name='style.chunk' value='${docbook.xsl.home}/html/chunk.xsl'/>
    <property name='style.fo' value='${docbook.xsl.home}/fo/docbook.xsl'/>
    <!-- This is default only for invoking some external docbook targets -->
    <property name='outputType' value='html'/>

    <!-- Note that we do not generate postscript by default -->
    <target name='docbook'
        description='Generate all DocBook docs in HTML and PDF formats'
            depends='docbooks-html, docbooks-chunk, docbooks-pdf'/>

    <target name='docbooks-html' depends='-initContrib'
            description='Generate all DocBook non-chunk HTML output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='html'/>
        </antcall>
    </target>
    <target name='docbooks-chunk' depends='-initContrib'
            description='Generate all DocBook Chunk HTML output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='chunk'/>
        </antcall>
    </target>
    <target name='docbooks-pdf' depends='-initContrib'
            description='Generate all DocBook PDF output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='pdf'/>
        </antcall>
    </target>
    <target name='docbooks-ps' depends='-initContrib'
            description='Generate all DocBook Postscript output'>
        <antcall inheritall='false' target='-ddIterate'>
            <param name='outputType' value='ps'/>
        </antcall>
    </target>

    <target name='-ddIterate'>
        <!-- Iterate through docsrc dirs, invoking condlGenbok for each -->
        <!-- Internal caller MUST set 'outputType' -->
        <pathconvert property='_docsrcdirs' targetos='unix' pathsep='|'
                     setonempty='false'> <path>
             <dirset dir='docsrc' includes='*'/>
        </path> </pathconvert>
        <!-- If is needed so that ant doesn't fail if there are no
             DocDir documents -->
        <if><isset property='_docsrcdirs'/><then>
            <foreach list='${_docsrcdirs}' param='docdirpath' inheritall='false'
                     target='-condlGenbook' delimiter='|'>
                <param name='outputType' value='${outputType}'/>
            </foreach>
        </then></if>
    </target>

    <target name='-condlGenbook'>
        <!-- Conditionally run target 'html' or 'chunked' or 'pdf' -->
        <!-- Internal caller MUST set 'docdirpath' and 'outputType' -->
        <!-- Invoke genbook target iff corresponding DocBook src file exists -->
        <basename property='book' file='${docdirpath}'/>
        <!-- Note that inheritall is true, so we pass through all vars, incl.
             'book'.  N.b. This target (-condlGenbook) should be called
             with inheritall false!! -->
        <if> <available type='file' file='${docdirpath}/${book}.xml'/> <then>
            <antcall target='${outputType}'/>
        </then> </if>
    </target>

    <target name='-preDocbook'>
        <!-- description='Run before generating docbook for a partic. dir -->
        <!-- Required Props:  book -->
        <mkdir dir='docwork/${book}/cdata'/>
        <if><not><uptodate targetfile='docwork/${book}/cdata/.status'>
            <!-- Mappers don't work for shit with multiple patterns.
            Therefore, have to use a timestamp file.  -->
            <srcfiles dir='src/org/hsqldb/sample'
             includes='*.java, *.txt, *.ksh, *.properties, *.rc, *.cfg, *.sql'/>
        </uptodate></not><then>
            <!-- This copies files matching the fileset below to the docwork
                 dir w/ data so that DocBook may entity include them.
                 For the time being, these files must reside in the main
                 directory  for this specific book. -->
            <pathconvert property='_virginfiles' targetos='unix' pathsep='|'
                         setonempty='false'> <path>
                 <fileset dir='src/org/hsqldb/sample'
             includes='*.java, *.txt, *.ksh, *.properties, *.rc, *.cfg, *.sql'/>
            </path> </pathconvert>
            <if><isset property='_virginfiles'/><then>
                <foreach list='${_virginfiles}' param='vfile' inheritall='false'
                    target='-sandwich' delimiter='|'>
                    <param name='book' value='${book}'/>
                </foreach>
            </then></if>
        </then></if>
        <touch file='docwork/${book}/cdata/.status'/>
    </target>

    <target name='-postDocbook'>
        <!-- Run after generating docbook for a partic. dir -->
        <!-- Property 'book' MUST be set before calling this target -->
        <copy todir='doc'>
            <fileset dir='docsrc' excludes='.*, *.css, *.java, *.sql, *.txt'/>
        </copy>
        <copy todir='doc/${book}'>
            <fileset dir='docsrc/${book}'
                     excludes='.*, *.css, *.java, *.sql, *.txt'/>
        </copy>
        <delete file='doc/${book}/${book}.bs'/>
    </target>

    <target name='chunk' description='Build one Chunk HTML DocBook book'
            depends='-setXsltFilesets'>
        <fail unless='book'
              message="You must set property 'book' to use target 'chunk'"/>
        <dependset>
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
              <!-- This messy because ant doesn't support wildcard
              ch[0-9]*.html -->
            <targetfileset  dir='doc/${book}'
                includes='ch0*.html, ch1*.html, ch2*.html, ch3*.html,
                         ch4*.html, ch5*.htlm, ch6*.html, ch7*.html,
                         ch8*.html, ch9*.html, index.html'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/index.html'/></not>
        <then>
            <antcall target='-preDocbook'/>
            <fail unless='style.chunk'
                  message="You must set property 'style.chunk'"/>
            <antcall target='-htmlXslt' inheritall='false'>
                <param name='_stylesheet' value='${style.chunk}'/>
                <param name='book' value='${book}'/>
                <param name='_ext' value='.bs'/>
            </antcall>
            <antcall target='-postDocbook'/>
        </then></if>
        <copy todir='doc'>
            <fileset dir='docsrc'
                     includes='**/*.css, **/*.java, **/*.sql, **/*.txt'/>
        </copy>
    </target>
    <target name='html' description='Build one single-page HTML DocBook book'
            depends='-setXsltFilesets'>
        <fail unless='book'
              message="You must set property 'book' to use target 'html'"/>
        <dependset>
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
            <targetfileset  dir='doc/${book}' includes='${book}.html'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/${book}.html'/></not>
        <then>
            <antcall target='-preDocbook'/>
            <antcall target='-htmlXslt' inheritall='false'>
                <param name='_stylesheet' value='${style.html}'/>
                <param name='book' value='${book}'/>
            </antcall>
            <antcall target='-postDocbook'/>
        </then></if>
        <copy todir='doc'>
            <fileset dir='docsrc'
includes='**/*.css, **/*.java, **/*.sql, **/*.txt, **/*.properties, **/*.cfg'/>
        </copy>
    </target>
    <target name='fo' description='Build one DocBook FO file'
            depends='-initContrib, -setXsltFilesets'>
        <fail unless='book'
              message="You must set property 'book' to use target 'fo'"/>
        <dependset>
            <!-- Images and included files may be needed for .fo gen and
                 pdf/ps gen.  Need to test that to optimize the dependsets. -->
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
              <!-- This messy because ant doesn't support wildcard
              ch[0-9]*.html -->
            <targetfilelist  dir='docwork/${book}' files='${book}.fo'/>
        </dependset>
        <if><not><available type='file'
                            file='docwork/${book}/${book}.fo'/></not>
        <then>
            <antcall target='-preDocbook'/>
            <fail unless='style.html'
                  message="You must set property 'style.html'"/>
            <antcall target='-foXslt' inheritall='false'>
                <param name='book' value='${book}'/>
            </antcall>
            <antcall target='-postDocbook'/>
        </then></if>
    </target>
    <target name='pdf' depends='fo'>
        <!-- The depended-upon fo target will check required props -->
        <dependset>
            <!-- Images and included files may be needed for .fo gen and
                 pdf/ps gen.  Need to test that to optimize the dependsets. -->
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
            <srcfilelist dir='docwork/${book}' files='${book}.fo'/>
            <targetfilelist dir='doc/${book}' files='${book}.pdf'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/${book}.pdf'/></not>
        <then>
            <antcall target='-fop' inheritall='false'>
                <param name='_lvl' value='${fop-loglevel}'/>
                <param name='_fmt' value='application/pdf'/>
                <param name='book' value='${book}'/>
            </antcall>
        </then></if>
    </target>
    <target name='ps' depends='fo'>
        <!-- The depended-upon fo target will check required props -->
        <dependset>
            <!-- Images and included files may be needed for .fo gen and
                 pdf/ps gen.  Need to test that to optimize the dependsets. -->
            <srcfileset refid='sharedXsltSrcFiles'/>
            <srcfileset refid='bookXsltSrcFiles'/>
            <srcfilelist dir='docwork/${book}' files='${book}.fo'/>
            <targetfilelist dir='doc/${book}' files='${book}.ps'/>
        </dependset>
        <if><not><available type='file' file='doc/${book}/${book}.ps'/></not>
        <then>
            <antcall target='-fop' inheritall='false'>
                <param name='_lvl' value='${fop-loglevel}'/>
                <param name='_fmt' value='application/postscript'/>
                <param name='book' value='${book}'/>
            </antcall>
        </then></if>
    </target>

    <target name='-checkXslt' unless='_xsltChecked'>
        <!-- Don't call this before -initContrib called -->
        <if><not> <available
            classname='org.apache.xalan.processor.TransformerFactoryImpl'/>
        </not><then>
        <fail message="XSLT library not available.  See 'readmedocbook.txt'"/>
        </then></if>
        <property name='_xsltChecked' value='true'/>
    </target>

    <target name='-setXsltFilesets'>
        <!-- You MUST set property 'book' before calling this target -->
        <fileset id='bookXsltSrcFiles' dir='docsrc/${book}'
            includes='**/*.xml, **/*.png, **/*.jpg, **/*.txt, **/*.java,
                      **/*.sql, **/*.properties, **/*.rc, **/*.cfg'/>
        <fileset id='sharedXsltSrcFiles' dir='docsrc'
                includes='*.xml, *.txt, *.png, *.java, *.jpg, *.html, *.sql'/>
    </target>

    <target name='-sandwich'>
        <basename property='base' file='${vfile}'/>
        <loadfile srcfile='${vfile}' property='content'/>
        <dependset>
            <srcfilelist dir='src/org/hsqldb/sample' files='${base}'/>
            <targetfilelist dir='docwork/${book}/cdata' files='${base}'/>
        </dependset>
        <if><not><available file='docwork/${book}/cdata/${base}'/></not>
        <then>
            <mkdir dir='docwork/${book}/cdata'/>
            <echo file='docwork/${book}/cdata/${base}'
                  message='&lt;![CDATA[${content}]]&gt;'/>
        </then></if>
    </target>

    <!-- I'm not sure that <fop> actually needs the Xslt libs, but it
         probably does.  Test this sometime.  -->
    <target name='-initFop' unless='_fop_initted' depends='-checkXslt'>
        <fail unless='fop.home'
  message="To build from DocBook FO files, you must set property 'fop.home'"/>
        <if><not><available file='${fop.home}' type='dir'/></not><then>
            <fail message="The &lt;fop&gt; target not found where expected under '${fop.home}'"/>
        </then></if>
        <taskdef name="fop" classname="org.apache.fop.tools.anttasks.Fop">
            <classpath>
                <fileset dir='${fop.home}/build' includes='fop*.jar'/>
                <!-- See the FOP docs for why these are needed, and where
                     to get them from -->
                <fileset dir='${fop.home}/lib'
                         includes='avalon*.jar, batik*.jar, jimi*.jar'/>
            </classpath>
        </taskdef>
        <property name='_fop_initted' value='true'/>
    </target>

    <target name='-initContrib' unless='_contrib_initted'>
        <!-- We use ant-contrib-X.jar (where X is a version).  Make sure
             that this jar is located at path-to-ant-bin/../lib -->
        <available property='_contrib_there'
                   classname='net.sf.antcontrib.logic.For'/>
        <fail unless='_contrib_there' message="You must put a recent cut of ant-contrib-X.jar into 'path-to-ant-bin/../lib/'"/>
        <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
        <property name='_contrib_initted' value='true'/>
    </target>

    <target name='-fop' depends='-initFop'>
        <!-- Required properties:  book, _lvl, _fmt -->
        <fop format="${_fmt}" outdir="doc/${book}" messagelevel="${_lvl}"
            basedir='docsrc/${book}'>
            <fileset file='docwork/${book}/${book}.fo'/>
        </fop>
    </target>

    <target name='-htmlXslt' depends='-checkXslt'>
        <!-- This does not check dependencies.  Do that before calling. -->
        <!-- Required properties:  _stylesheet, book -->
        <fail if='_css' message="Internal property '_css' set externally"/>
        <fail unless='docbook.xsl.home' message="To use the DocBook targets, you must set property 'docbook.xsl.home"/>
        <if><not><available type='file' file='${_stylesheet}'/></not><then>
            <fail message="DocBook style sheet '${_stylesheet}' not found."/>
        </then></if>
        <available property='_css' value='${book}.css' type='file'
                   file='docsrc/${book}/${book}.css'/>
        <property name='_css' value='../shared.css'/>
        <property name='_ext' value='.html'/>
        <style
               basedir='docsrc/${book}'
               destdir='doc/${book}'
               force='yes'
               style='${_stylesheet}'
               includes='${book}.xml'
               extension='${_ext}'>
            <param name='html.stylesheet' expression='${_css}'/>
            <param name='navig.graphics' expression='true'/>
            <param name='navig.graphics.path' expression='navicons/'/>
            <param name='navig.graphics.extension' expression='.gif'/>
            <param name='chunk.section.depth' expression='0'/>
        </style>
    </target>

    <target name='-foXslt' depends='-checkXslt'>
        <!-- This does not check dependencies.  Do that before calling. -->
        <!-- Required props:  book -->
        <fail unless='docbook.xsl.home' message="To use the DocBook targets, you must set property 'docbook.xsl.home"/>
        <if><not><available type='file' file='${style.fo}'/></not><then>
            <fail message="DocBook style sheet '${style.fo}' not found."/>
        </then></if>
        <style
               basedir='docsrc/${book}'
               destdir='docwork/${book}'
               force='yes'
               style='${style.fo}'
               includes='${book}.xml'
               extension='.fo'
         >
            <param name='use.extensions' expression='1'/>
            <param name='tablecolumns.extension' expression='0'/>
            <param name='textinsert.extension' expression='1'/>
            <param name='fop.extensions' expression='1'/>
         </style>
    </target>

    <target name='clean-doc' description='Remove derived documentation files'
            depends='clean-docwork'>
        <!-- The target files here are hard-coded.
             If there are no objections, I'd like to move all CVS-controlled
             files to the docsrc directory.
             At that point, doc will contain only derived files, and this
             target can just wipe out the docwork and doc directories. -->
        <delete quiet='true' includeEmptyDirs='true'>
            <fileset dir='doc' includes='*.gif, *.css, guide/**'/>
        </delete>
        <delete dir='docwork' quiet='true' includeEmptyDirs='true'/>
    </target>

    <target name='clean-docwork' description='Remove temporary documentation files'>
        <delete dir='docwork' quiet='true' includeEmptyDirs='true'/>
        <delete quiet='true' includeEmptyDirs='true'>
            <fileset dir='doc' includes='**/*.xml'/>
        </delete>
    </target>
</project>
